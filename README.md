# JavAssistant Ultimate | Jav åŠ©æ‰‹ç»ˆæç‰ˆ

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Version](https://img.shields.io/badge/Version-24.0-blue.svg)]()

0 ä»£ç ç»éªŒå°ç™½åˆ©ç”¨ gemini ç”Ÿæˆçš„å°å‹æ’ä»¶
ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æµè§ˆå™¨æ‰©å±•ï¼Œä¸“ä¸ºå½±è§†ç•ªå·è‡ªåŠ¨è¯†åˆ«ã€ç£åŠ›é“¾æ¥å¤„ç†åŠ BBS è®ºå›ä¼˜åŒ–è€Œç”Ÿã€‚
A powerful browser extension designed for automatic AV code identification, magnet link processing, and BBS forum optimization.

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½ | Features

### 1. æ™ºèƒ½è¯†åˆ« (Smart Identification)
* **å…¨æ ¼å¼æ”¯æŒ**ï¼šç²¾å‡†è¯†åˆ«æ ‡å‡†ç•ªå·ï¼ˆå¦‚ `MIDE-123`ï¼‰åŠæ¨¡ç³Šæ ¼å¼ï¼ˆå¦‚ `sinn023`, `stars 968`ï¼‰ã€‚
* **FC2 ä¸“é¡¹ä¼˜åŒ–**ï¼šè‡ªåŠ¨è¡¥å…¨å¹¶è¯†åˆ« `FC2-PPV` å˜ä½“ï¼Œæ”¯æŒå¸¦ç©ºæ ¼æˆ–ä¸è§„èŒƒå†™æ³•ã€‚
* **BBS æ ‡é¢˜ç©¿é€**ï¼šå”¯ä¸€æ”¯æŒåœ¨è®ºå›åˆ—è¡¨é¡µæ ‡é¢˜ä¸­ç›´æ¥é«˜äº®ç•ªå·ï¼Œæ— éœ€è¿›å¸–å³å¯é¢„è§ˆã€‚

### 2. äº¤äº’ä½“éªŒ (Interactive Experience)
* **æ‚¬æµ®é¢„è§ˆçª—**ï¼šç‚¹å‡»æ™®é€šç•ªå·å¼¹å‡ºå†…åµŒ JavBus è¯¦æƒ…é¡µï¼Œæ”¯æŒ**å…¨è¾¹æ¡†æ‹–æ‹½ç§»åŠ¨**ã€‚
* **è‡ªå®šä¹‰ç¼©æ”¾**ï¼šå³ä¸‹è§’æ‹‰ä¼¸å³å¯è°ƒæ•´çª—å£å¤§å°ï¼Œå¹¶è‡ªåŠ¨è®°å¿†ä½ç½®ä¸å°ºå¯¸ã€‚
* **FC2 å¿«é€Ÿç›´è¾¾**ï¼šç‚¹å‡» FC2 ç•ªå·ç›´æ¥è·³è½¬è‡³ MissAV æœç´¢ï¼Œè§£å†³å†…åµŒé™åˆ¶ã€‚

### 3. ç£åŠ›å·¥å…· (Magnet Integration)
* **ä¸€é”®å¤åˆ¶**ï¼šé«˜äº® Magnet é“¾æ¥åŠ 40 ä½ Hash è¯†åˆ«ç ï¼ˆç´«è‰²æ ‡è¯†ï¼‰ã€‚
* **è‡ªåŠ¨è¡¥å…¨**ï¼šç‚¹å‡»çº¯è¯†åˆ«ç æ—¶ï¼Œè‡ªåŠ¨è¡¥å…¨ä¸º `magnet:?xt=urn:btih:` æ ¼å¼åå­˜å…¥å‰ªè´´æ¿ã€‚
* **è§†è§‰åé¦ˆ**ï¼šå†…ç½®è½»é‡çº§â€œå¤åˆ¶æˆåŠŸâ€æç¤ºã€‚

---

## ğŸš€ å®‰è£…æ­¥éª¤ | Installation

1. **ä¸‹è½½é¡¹ç›®**ï¼šç‚¹å‡»å³ä¸Šè§’ `Code` -> `Download ZIP` å¹¶è§£å‹åˆ°æœ¬åœ°ã€‚
2. **åŠ è½½æ‰©å±•**ï¼š
   - æ‰“å¼€ Chrome/Edge æµè§ˆå™¨ï¼Œè®¿é—® `chrome://extensions/`ã€‚
   - å¼€å¯å³ä¸Šè§’çš„ **â€œå¼€å‘è€…æ¨¡å¼â€ (Developer Mode)**ã€‚
   - ç‚¹å‡» **â€œåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºâ€ (Load unpacked)**ã€‚
   - é€‰æ‹©è§£å‹åçš„æ–‡ä»¶å¤¹ã€‚
3. **å›ºå®šå›¾æ ‡**ï¼šç‚¹å‡»æµè§ˆå™¨æ‹¼å›¾å›¾æ ‡ï¼Œå°† JavAssistant å›ºå®šåœ¨ä»»åŠ¡æ ã€‚

---

## ğŸ›  æŠ€æœ¯å®ç° | Technical Details

* **åŒè·¯åŒ¹é…å¼•æ“**ï¼šåŸºäº `TreeWalker` æ·±åº¦éå†æ–‡æœ¬èŠ‚ç‚¹ï¼Œä¸ç ´åç½‘é¡µåŸæœ‰æ ·å¼ã€‚
* **æ­£åˆ™å»å™ª**ï¼šå†…ç½®é»‘åå•ï¼ˆå¦‚ HTML, POST ç­‰ï¼‰å’Œæ­£åˆ™åŠ æƒï¼Œå¤§å¹…é™ä½ 8 ä½éšæœº ID è¯¯åˆ¤ã€‚
* **äº‹ä»¶åŠ«æŒ**ï¼šåœ¨ BBS æ ‡é¢˜ä¸­ç‚¹å‡»æ—¶ï¼Œä¼˜å…ˆæ‹¦æˆªè·³è½¬è¯·æ±‚ä»¥å¼¹å‡ºé¢„è§ˆçª—ã€‚

## ğŸ› ï¸ éƒ¨ç½²ä¸å®‰è£…æ­¥éª¤

å¦‚æœä½ æ˜¯å¼€å‘è€…æˆ–æƒ³æ‰‹åŠ¨éƒ¨ç½²ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

### 1. å»ºç«‹é¡¹ç›®æ–‡ä»¶å¤¹
åœ¨ç”µè„‘æœ¬åœ°åˆ›å»ºä¸€ä¸ªåä¸º `JavAssistant` çš„æ–‡ä»¶å¤¹ã€‚

### 2. åˆ›å»ºæ ¸å¿ƒæ–‡ä»¶
åœ¨è¯¥æ–‡ä»¶å¤¹å†…åˆ†åˆ«åˆ›å»ºä»¥ä¸‹ 4 ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†æœ¬æ–‡ä¸‹æ–¹çš„ä»£ç å¯¹åº”ç²˜è´´è¿›å»ï¼š
- `manifest.json`
- `background.js`
- `content.js`
- `content.css`

### 3. åŠ è½½è‡³æµè§ˆå™¨
1. æ‰“å¼€ Chrome æˆ– Edge æµè§ˆå™¨ï¼Œè®¿é—® `chrome://extensions/`ã€‚
2. å¼€å¯å³ä¸Šè§’çš„ **â€œå¼€å‘è€…æ¨¡å¼â€**ã€‚
3. ç‚¹å‡» **â€œåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºâ€**ã€‚
4. é€‰æ‹©ä½ åˆšåˆšåˆ›å»ºçš„ `JavAssistant` æ–‡ä»¶å¤¹ã€‚

---

## ğŸ’» å®Œæ•´æºä»£ç  (V24.0)

### 1. manifest.json
```json
{
  "manifest_version": 3,
  "name": "JavAssistant Ultimate",
  "version": "24.0",
  "permissions": ["storage", "contextMenus", "tabs"],
  "host_permissions": ["<all_urls>"],
  "background": { "service_worker": "background.js" },
  "content_scripts": [{
    "matches": ["<all_urls>"],
    "js": ["content.js"],
    "css": ["content.css"]
  }]
}

### 2. background.js
chrome.runtime.onInstalled.addListener(() => {
  chrome.contextMenus.create({ id: "missav_direct", title: "ğŸ“º MissAV æœç´¢: %s", contexts: ["selection"] });
});
chrome.contextMenus.onClicked.addListener((info) => {
  if (info.menuItemId === "missav_direct") {
    const code = info.selectionText.trim().toUpperCase();
    chrome.tabs.create({ url: "[https://missav.ws/search/](https://missav.ws/search/)" + encodeURIComponent(code) });
  }
});
### 3. background.js
.jav-mark { 
    background: #fff200 !important; color: #000 !important; border-radius: 3px; 
    padding: 0px 4px; cursor: pointer !important; font-weight: bold !important; 
    display: inline-block; line-height: 1.4; user-select: all !important; text-decoration: none !important;
}
.mag-mark { background: #e0b3ff !important; color: #330066 !important; }
#copy-tip {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.8); color: white; padding: 10px 20px;
    border-radius: 20px; z-index: 2147483647; display: none; font-size: 14px;
}
#jav-box {
    position: fixed; right: 20px; top: 20px; background: white; border: 2px solid #0071e3; 
    border-radius: 12px; box-shadow: 0 10px 50px rgba(0,0,0,0.4); z-index: 2147483647;
    display: none; flex-direction: column; overflow: hidden; min-width: 380px; min-height: 450px;
}
#jav-hdr { padding: 12px 15px; background: #0071e3; color: white; display: flex; justify-content: space-between; align-items: center; cursor: move; }
#jav-close { background: white; color:#0071e3; border:none; border-radius:50%; width:24px; height:24px; cursor:pointer; font-weight:bold; }
.jav-edge { position: absolute; background: transparent; z-index: 2147483648; }
.v-edge { cursor: ew-resize; top: 0; bottom: 0; width: 10px; }
.h-edge { cursor: ns-resize; left: 0; right: 0; height: 10px; }
#jav-resizer { width: 20px; height: 20px; position: absolute; right: 0; bottom: 0; cursor: nwse-resize; z-index: 2147483649; }
#jav-resizer::after { content: ""; position: absolute; right: 4px; bottom: 4px; border-style: solid; border-width: 0 0 12px 12px; border-color: transparent transparent #0071e3 transparent; }

### 4. content.js
cat << 'EOF' > content.js
const regFC = /\b(fc2)[-\s]?(ppv)?[-\s]?(\d{5,8})\b/gi;
const regNormal = /\b([a-z]{2,6})[-\s]?(\d{3,5})\b/gi;
// è¯†åˆ« å®Œæ•´çš„ç£åŠ›é“¾æ¥ æˆ– 40ä½Hash
const regMag = /(magnet:\?xt=urn:btih:[a-fA-F0-9]{40})|(\b[a-fA-F0-9]{40}\b)/gi;

function highlight() {
    const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, {
        acceptNode: n => {
            const p = n.parentElement;
            if (p.closest('script, style, textarea, input, .jav-mark')) return NodeFilter.FILTER_REJECT;
            return NodeFilter.FILTER_ACCEPT;
        }
    });

    let nodes = [];
    while (node = walker.nextNode()) nodes.push(node);

    nodes.forEach(n => {
        const text = n.nodeValue;
        let html = text;

        // 1. å¤„ç†ç£åŠ›é“¾æ¥ (ä¼˜å…ˆçº§æœ€é«˜)
        html = html.replace(regMag, m => `<mark class="jav-mark mag-mark" data-type="mag" data-code="${m}">${m.length > 10 ? m.substring(0,8)+'...'+m.substring(m.length-8) : m}</mark>`);
        
        // 2. å¤„ç† FC2
        html = html.replace(regFC, m => `<mark class="jav-mark" data-type="jav" data-code="${m}">${m}</mark>`);
        
        // 3. å¤„ç†æ™®é€šç•ªå·
        html = html.replace(regNormal, (m, p1, p2) => {
            if (['HTTP', 'HTML', 'GZIP', 'POST'].includes(p1.toUpperCase())) return m;
            return `<mark class="jav-mark" data-type="jav" data-code="${p1.toUpperCase()}-${p2}">${m}</mark>`;
        });

        if (html !== text) {
            const span = document.createElement('span');
            span.innerHTML = html;
            n.parentNode.replaceChild(span, n);
        }
    });
}

// å¤åˆ¶åŠŸèƒ½å‡½æ•°
function copyToClipboard(text) {
    const el = document.createElement('textarea');
    el.value = text;
    document.body.appendChild(el);
    el.select();
    document.execCommand('copy');
    document.body.removeChild(el);
    
    // æ˜¾ç¤ºæç¤º
    let tip = document.getElementById('copy-tip');
    if (!tip) {
        tip = document.createElement('div');
        tip.id = 'copy-tip';
        document.body.appendChild(tip);
    }
    tip.textContent = "å·²æˆåŠŸå¤åˆ¶ç£é“¾/è¯†åˆ«ç ";
    tip.style.display = 'block';
    setTimeout(() => tip.style.display = 'none', 1500);
}

document.body.addEventListener('click', e => {
    const target = e.target.closest('.jav-mark');
    if (!target) return;

    e.preventDefault();
    e.stopPropagation();

    const type = target.dataset.type;
    const code = target.dataset.code;

    if (type === 'mag') {
        // ç£åŠ›é“¾æ¥é€»è¾‘ï¼šç›´æ¥å¤åˆ¶
        let copyText = code;
        // å¦‚æœåªæ˜¯è¯†åˆ«ç ï¼Œè‡ªåŠ¨è¡¥å…¨æˆæ ‡å‡†ç£åŠ›é“¾æ¥æ ¼å¼æ–¹ä¾¿ä¸‹è½½å™¨è¯†åˆ«
        if (!code.startsWith('magnet:')) {
            copyText = `magnet:?xt=urn:btih:${code}`;
        }
        copyToClipboard(copyText);
    } else {
        // ç•ªå·é€»è¾‘ï¼šåŸæœ‰å¼¹çª—é€»è¾‘
        showJavBox(code);
    }
}, true);

function showJavBox(code) {
    const c = code.toUpperCase();
    if (c.startsWith('FC')) {
        window.open("https://missav.ws/search/" + encodeURIComponent(c), "_blank");
        return;
    }
    chrome.storage.sync.get(['winW', 'winH', 'winX', 'winY'], d => {
        let box = document.getElementById('jav-box');
        if (!box) {
            box = document.createElement('div'); box.id = 'jav-box';
            box.innerHTML = `<div id="edge-l" class="jav-edge v-edge"></div><div id="edge-r" class="jav-edge v-edge"></div><div id="edge-b" class="jav-edge h-edge"></div>
                <div id="jav-hdr"><span id="jav-title" style="font-size:13px; font-weight:bold;"></span><button id="jav-close">Ã—</button></div>
                <iframe id="jav-ifr" style="flex:1; border:none; background:white;"></iframe><div id="jav-resizer"></div>`;
            document.body.appendChild(box);
            // ...çœç•¥é‡å¤çš„æ‹–æ‹½é€»è¾‘ä»¥å‡å°ç¯‡å¹…ï¼Œä¿æŒV23é€»è¾‘...
            let isD = false, oX, oY, isR = false;
            const sD = (ev) => { isD = true; oX = box.offsetLeft - ev.clientX; oY = box.offsetTop - ev.clientY; };
            document.getElementById('jav-hdr').onmousedown = sD;
            document.getElementById('jav-resizer').onmousedown = ev => { isR = true; ev.preventDefault(); };
            window.addEventListener('mousemove', ev => {
                if (isD) { box.style.left = (ev.clientX + oX) + 'px'; box.style.top = (ev.clientY + oY) + 'px'; }
                if (isR) { box.style.width = Math.max(350, ev.clientX - box.offsetLeft) + 'px'; box.style.height = Math.max(400, ev.clientY - box.offsetTop) + 'px'; }
            });
            window.addEventListener('mouseup', () => { isD = false; isR = false; });
            document.getElementById('jav-close').onclick = () => box.style.display = 'none';
        }
        box.style.display = 'flex';
        box.style.width = d.winW || '450px'; box.style.height = d.winH || '600px';
        if(d.winX) { box.style.left = d.winX; box.style.top = d.winY; box.style.right = 'auto'; }
        document.getElementById('jav-title').textContent = "JavBus: " + c;
        document.getElementById('jav-ifr').src = "https://www.javbus.com/" + c;
    });
}

// å¤šæ¬¡æ‰§è¡Œç¡®ä¿è®ºå›åŠ¨æ€å†…å®¹è¢«æ•è·
setTimeout(highlight, 1000);
setTimeout(highlight, 3000);
EOF




## ğŸ“„ å¼€æºåè®® | License

æœ¬é¡¹ç›®éµå¾ª [MIT License](LICENSE) åè®®å¼€æºã€‚

---

## âš ï¸ å…è´£å£°æ˜ | Disclaimer

æœ¬æ’ä»¶ä»…ä½œä¸ºç½‘é¡µå†…å®¹è¾…åŠ©è¯†åˆ«å·¥å…·ï¼Œä¸å­˜å‚¨ã€ä¸åˆ†å‘ã€ä¸æä¾›ä»»ä½•è§†é¢‘èµ„æºã€‚è¯·åœ¨éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„çš„å‰æä¸‹ä½¿ç”¨ã€‚
This extension is only a helper tool for content identification and does not store or distribute any media resources.
